<!doctype html>
{% set coffee_state = {
    0: 'fa-meh-blank',
    1: 'fa-surprise',
    2: 'fa-smile-wink',
    3: 'fa-smile-beam',
    4: 'fa-grin',
    5: 'fa-grin-wink',
    6: 'fa-grin-stars',
    7: 'fa-grimace',
} %}
<html lang="en">
    <head>
        <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap-4.6.0-dist/css/bootstrap.min.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='fontawesome-free-5.15.2-web/css/all.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='coffeetag.css') }}">
        <script src="{{ url_for('static', filename='jquery-3.6.0.min.js') }}"></script>
        <script src="{{ url_for('static', filename='bootstrap-4.6.0-dist/js/bootstrap.bundle.min.js') }}"></script>
        <script src="{{ url_for('static', filename='matrix-0.0.1.js') }}" defer></script>
        <script>
         $(() => {
             if (window.location.search.search('notimeout') == -1)
             {
                 const autologout_time = 20;
                 setTimeout(() => {
                     window.location.href = '../';
                 }, autologout_time * 1000);
                 setInterval(() => {
                     $('#autologout-bar-container').children()[0].remove();
                 }, 1000);
                 for (var i = 0; i < autologout_time; i++) {
                     $("<div></div>")
                         .appendTo('#autologout-bar-container')
                         .addClass('autologout-bar-ruler')
                         .css('width', $('#autologout-bar-container').width() / autologout_time - 2);
                 }
             }
         });
        </script>
        <style>
         .btnbar {
             width: 200px;
         }

         .btnbar > * {
             border: none;
             border-bottom: 1px solid var(--color-engineering);
             border-radius: 0;
             padding: 1.5rem 0.3rem 1.5rem 1rem ;
             font-size: 1.2rem;
             width: 100%;
             text-align: left;
             white-space: nowrap;
         }

         .btnbar > button:last-child {
             margin-top: auto;
             border-top: 1px solid var(--color-engineering);
             border-bottom: none;
         }

         .btnbar-button-icon {
             font-size: 1.75rem;
             /* TODO: No idea why the icon is optically higher than the text */
             transform: translateY(3px);
             width: 35px;
         }

         .btn-coffee {
             padding: 25px 40px 20px 40px;
             border-radius: 15px;
             color: var(--color-berry);
         }

         .coffeemeter-title {
             position: absolute;
             bottom: 0;
             font-size: 1.3rem;
             margin-left: 0.5rem;
             transform-origin: 0 100%;
             transform: rotate(-90deg);
             color: var(--color-engineering);
         }

         .coffeemeter-tag {
             position: absolute;
             bottom: 0;
             width: 100%;
             font-size: 1.75rem;
             color: var(--color-engineering-light);
             text-align: center;
             margin-bottom: 1rem;
         }

         #matrix {
             position: absolute;
             display: block;
         }

         #autologout-bar-container {
             position: absolute;
             bottom: 0;
             left: 0;
             width: 200px;
         }

         .autologout-bar-ruler {
             height: 3px;
             background: var(--color-engineering);
             border-radius: 3px;
             margin-left: 1px;
             margin-right: 1px;
         }
        </style>
    </head>
    <body>
        <div class="d-flex flex-row w-100 h-100">
            <div style="width: 200px">
                <form method="post" class="h-100">
                    <div class="d-flex flex-column h-100 btnbar">
                        <div class="" type="submit">
                            <span>Your bill:
                                <span class="h3"> {{ "%.2f €" | format(user.unpayed) }}</span>
                            </span>
                        </div>
                        <button type="submit" name="pay" value={{ config['PAY'] }}>
                            <span class="btnbar-button-icon fas fa-euro-sign"></span>
                            <span>payed {{ config['PAY'] }}€</span>
                        </button>
                        <button type="submit" name="undopay">
                            <span class="btnbar-button-icon fas fa-undo-alt"></span>
                            <span>undo last pay</span>
                        </button>
                        <button type="submit" name="edituser">
                            <span class="btnbar-button-icon fas fa-edit"></span>
                            <span>edit user</span>
                        </button>
                        <button type="submit" name="logout">
                            <span class="btnbar-button-icon fas fa-sign-out-alt"></span>
                            <span>Logout</span>
                            <div id="autologout-bar-container" class="d-flex flex-row">
                            </div>
                        </button>
                    </div>
                </form>
            </div>
            <div class="d-flex flex-column flex-grow text-center w-100 mx-5 my-4">
                <div class="text-left">
                    <h3>Hi</h3>
                    <h1 id="user-name">{{ user.prename }} {{ user.name }}</h1>
                    <code class="h5">{{ hexstr(user.tag) }}</code>
                </div>
                <div class="my-auto">
                    <form method="post">
                        <button type="submit" class="btn-coffee" name="coffee" value="coffee">
                            <div class="display-1 fas fa-coffee"></div>
                            <div class="h3">Take one coffee</div>
                        </button>
                    </form>
                </div>
            </div>
            <div class="d-flex m-4" style="width: 100px;">
                <div class="position-relative h-100 w-100">
                    <div class="coffeemeter-title">
                        COFFEEMETER
                    </div>
                    <div class="coffeemeter-tag">
                        {{ len(user.coffees_today) }}
                    </div>
                    <div class="d-flex flex-column h-100">
                        <div class="display-2 fas {{ coffee_state[min(len(coffee_state) - 1, len(user.coffees_today))] }}"
                             style="{{ 'color: var(--danger);' if len(user.coffees_today) >= len(coffee_state) }}">
                        </div>
                        <div class="d-flex flex-column justify-content-end h-100 border mt-2 px-2">
                            <div class="bg-engineering-dark m-1 rounded"
                                 style="height: {{ len(user.coffees_today) / len(coffee_state) * 100 | round }}%;
                                     {{ 'background: var(--danger); color: white;' if len(user.coffees_today) >= len(coffee_state) }}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <canvas id="matrix"></canvas>
    </body>
</html>
